#summary How to create a wiki tag extension
#sidebar TableOfContents

<wiki:toc max_depth="2" />

== Introduction ==
In the following steps we would like to create a new wiki tag which should support the [http://code.google.com/apis/chart/ Google Chart API].

A wiki text like the following should for example show a TeX formula as an Image:
{{{
  <chart cht=tx chl="x = \\frac{-b \\pm \\sqrt {b^2-4ac}}{2a}" />
}}}

or the following should for example show a barchart
{{{
<chart 
  cht=bvs 
  chs=800x300 
  chbh=20,1 
  chxt=x,y 
  chco=76A4FB 
  chls=2.0   
chd=t:1,2,3,6,9,13,20,28,37,49,60,72,83,92,98,100,98,92,83,72,60,49,37,28,20,13,9,6,3,2,1 
/>
}}}

== The chart tag implementation ==
The complete source code for this "chart" tag can be found in SVN: [http://code.google.com/p/gwtwiki/source/browse/trunk/info.bliki.wiki/bliki-core/src/main/java/info/bliki/wiki/tags/extension/ChartTag.java ChartTag.java]

To create a new tag extend the {{{HTMLTag}}} and implement the {{{INoBodyParsingTag}}}, because our chart tag needs no nested tag parsing:
{{{
public class ChartTag extends HTMLTag implements INoBodyParsingTag {
}}}
To allow all the Google Chart API parameters in the new tag, we define a set of allowed attributes and implement the {{{isAllowedAttribute()}}} method:
{{{
...
final static public HashSet<String> ALLOWED_ATTRIBUTES_SET = new HashSet<String>(997);

final static public String[] ALLOWED_ATTRIBUTES = { "alt", "chbh",....."chxtc" };

static {
  for (int i = 0; i < ALLOWED_ATTRIBUTES.length; i++) {
    ALLOWED_ATTRIBUTES_SET.add(ALLOWED_ATTRIBUTES[i]);
  }
}
...
...
public boolean isAllowedAttribute(String attName) {
  return ALLOWED_ATTRIBUTES_SET.contains(attName);
}
}}}

In your own derived wiki model add the new tag to the configuration:
{{{
...
static {
  Configuration.DEFAULT_CONFIGURATION.addTokenTag("chart", new ChartTag());
}
...
}}}

Now the new chart tag syntax can be used in your wiki application.