#summary Helper classes for the MediaWiki api.php.
#labels Featured
#sidebar TableOfContents

<wiki:toc max_depth="1" />

= Helper classes for the MediaWiki api.php =
Helper Classes for the [http://www.mediawiki.org/wiki/API MediaWiki API page] can be found in the package: {{{info.bliki.api}}}. All query parameters are described in the api.php page of the requested wiki. For example [http://en.wikipedia.org/w/api.php http://en.wikipedia.org/w/api.php] lists all parameters for en.wikipedia.org.

For example this snippet determines the categories used in the Wikimedia [http://meta.wikimedia.org/wiki/Main_Page Main Page] and [[http://meta.wikimedia.org/wiki/API API]] page:
{{{
	public static void testQueryCategories001() {
		String[] listOfTitleStrings = { "Main Page", "API" };
		User user = new User("", "", "http://meta.wikimedia.org/w/api.php");
		user.login();
		List<Page> listOfPages = user.queryCategories(listOfTitleStrings);
		for (Page page : listOfPages) {
			// print page information
			System.out.println(page.toString());
			for (int j = 0; j < page.sizeOfCategoryList(); j++) {
				Category cat = page.getCategory(j);
				// print every category in this page
				System.out.println(cat.toString());
			}
		}
	}
}}}

= Connecting through a HTTP proxy =
(Needs [http://code.google.com/p/gwtwiki/source/detail?r=635 revision 635])
In case you are using a proxy you can set the {{{HostConfiguration}}} for the connector. The {{{HostConfiguration}}} holds all of the variables needed to describe an HTTP connection to a host. This includes remote host, port and protocol, proxy host and port, local address, and virtual host. 
{{{
		Connector conn = user.getConnector();
		HttpClient client = conn.getClient();
		HostConfiguration hostConfiguration = client.getHostConfiguration();
		hostConfiguration.setProxy("<proxyHost>", 80);
		client.setHostConfiguration(hostConfiguration);
}}}

= Troubleshooting =
See: [http://hc.apache.org/httpclient-3.x/troubleshooting.html Trouble Shooting HttpClient]

= Example - Get all members of a category =
Get all members of the category "Category:Physics":

{{{
package info.bliki.api;

import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.List;

import org.xml.sax.SAXException;

public class APICategoryMembers {
	public APITest() {
		super();
	}

	public static void testQueryCategoryMembers() {
		User user = new User("", "", "http://en.wikipedia.org/w/api.php");
		user.login();
		String[] valuePairs = { "list", "categorymembers", "cmtitle", "Category:Physics" };
		Connector connector = new Connector();
		String rawXmlResponse = connector.queryXML(user, valuePairs);
		if (rawXmlResponse == null) {
			System.out.println("Got no XML result for the query");
		}
		System.out.println(rawXmlResponse);

		// When more results are available, use "cmcontinue" from last query result
		// to continue
		String[] valuePairs2 = { "list", "categorymembers", "cmtitle", "Category:Physics", "cmcontinue", "Awards|" };
		rawXmlResponse = connector.queryXML(user, valuePairs2);
		if (rawXmlResponse == null) {
			System.out.println("Got no XML result for the query");
		}
		System.out.println(rawXmlResponse);

	}


	public static void main(String[] args) {
		testQueryCategoryMembers();
	}
}

}}}

= Example - Get all interlanguage links =
Returns all interlanguage links from the given page.

{{{
package info.bliki.api;

import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.List;

import org.xml.sax.SAXException;

public class LangLinksTest {
	public LangLinksTest() {
		super();
	}

	public static void testQueryLangLinks() {
		User user = new User("", "", "http://en.wikipedia.org/w/api.php");
		user.login();
		String[] valuePairs = { "prop", "langlinks", "titles", "England" };
		Connector connector = new Connector();
		String rawXmlResponse = connector.queryXML(user, valuePairs);
		if (rawXmlResponse == null) {
			System.out.println("Got no XML result for the query");
		}
		System.out.println(rawXmlResponse);

		// When more results are available, use "llcontinue" from last query result
		// to continue
		String[] valuePairs2 = { "prop", "langlinks", "titles", "England", "llcontinue", "9316|bar" };

		rawXmlResponse = connector.queryXML(user, valuePairs2);
		if (rawXmlResponse == null) {
			System.out.println("Got no XML result for the query");
		}
		System.out.println(rawXmlResponse);

	}

	public static void main(String[] args) {
		testQueryLangLinks();
	}
}
}}}

= Example - Get the image URL =
 
Get the images url from "upload.wikimedia.org" for "File:Mona Lisa.jpg".

{{{
package info.bliki.api;

import java.util.List;

/**
 * Example for querying image info data
 */
public class QueryImageInfoExample {
	public static void main(String[] args) {
		String pageName = "File:Mona Lisa.jpg";
		User user = new User("", "", "http://en.wikipedia.org/w/api.php");
		Connector connector = new Connector();
		user = connector.login(user);

		System.out.println("PAGE-NAME: " + pageName);
		// set image width thumb size to 200px
		List<Page> pages = user.queryImageinfo(new String[] { pageName }, 200);

		System.out.println("PAGES: " + pages.get(0).getTitle());

		if (pages != null) {
			System.out.println("PAGES: " + pages.size());

		} else {
			System.out.println("PAGES: NULL!");
		}

		for (Page page : pages) {
			System.out.println("IMG-THUMB-URL: " + page.getImageThumbUrl());
			System.out.println("IMG-URL: " + page.getImageUrl());
		}
	}

}
}}}